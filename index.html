<!doctype html>
<!-- hellish ai slop -->
<html lang="en">
<head>
<meta charset="utf-8">
<title>windowr</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
body { background:#0f1724; color:#e6eef6; font-family: system-ui, sans-serif; padding:40px; }
textarea,input,button { width:100%; margin-top:10px; padding:10px; border-radius:8px; border:none; background:#0b1220; color:#e6eef6; font-size:14px; }
button { background:#7c5cff; color:#061226; font-weight:700; cursor:pointer; }
.status { margin-top:12px; color:#9aa4b2; font-size:13px; white-space:pre-line; }
</style>
</head>
<body>

<h2>Roblox Asset ZIP Downloader (Direct + Private)</h2>

<label>Game / Place ID (required for private assets)</label>
<input id="placeId" placeholder="e.g. 18687417158">

<label>Paste asset list</label>
<textarea id="list" rows="14" placeholder="Paste Lua table or text containing rbxassetid://..."></textarea>

<button id="start">Parse & Download ZIP</button>
<div class="status" id="status">Idle.</div>

<script>
const sleep = ms => new Promise(r => setTimeout(r, ms));

function parseIds(text){
  // match rbxassetid://<digits> optionally preceded by Lua key
  const matches = text.match(/rbxassetid:\/\/(\d+)/g) || [];
  return [...new Set(matches.map(x => x.split("://")[1]))];
}

// guess file extension from MIME type
function guessExt(mime){
  if(!mime) return 'dat';
  if(mime.includes('ogg')) return 'ogg';
  if(mime.includes('png')) return 'png';
  if(mime.includes('jpeg')) return 'jpg';
  if(mime.includes('x-roblox-mesh')) return 'mesh';
  if(mime.includes('x-roblox-model')) return 'rbxm';
  return 'dat';
}

async function fetchAsset(id, placeId){
  const url = `https://assetdelivery.roblox.com/v1/asset?id=${id}&placeId=${placeId}`;
  const resp = await fetch(url);
  if(!resp.ok) throw new Error(`HTTP ${resp.status}`);
  const data = await resp.arrayBuffer();
  const type = resp.headers.get('content-type');
  return { data, ext: guessExt(type) };
}

document.getElementById("start").onclick = async () => {
  const text = document.getElementById("list").value;
  const placeId = document.getElementById("placeId").value.trim();
  const status = document.getElementById("status");

  if(!text || !placeId){
    status.textContent = "Paste a list AND provide a place ID.";
    return;
  }

  const ids = parseIds(text);
  if(!ids.length){
    status.textContent = "No rbxassetid:// IDs found.";
    return;
  }

  status.textContent = `Found ${ids.length} assets. Fetching...\n`;

  const zip = new JSZip();
  let failed = [];
  let done = 0;

  for(const id of ids){
    try{
      status.textContent = `Downloading ${++done}/${ids.length} — ${id}`;
      const { data, ext } = await fetchAsset(id, placeId);
      zip.file(`${id}.${ext}`, data);
      await sleep(400); // rate-limit
    }catch(e){
      failed.push(id);
      console.warn("Failed:", id, e);
    }
  }

  if(failed.length) {
    zip.file('failed.txt', failed.join('\n'));
    status.textContent += `\n${failed.length} failed downloads. See failed.txt in ZIP.`;
  }

  status.textContent += "\nBuilding ZIP…";
  const blob = await zip.generateAsync({ type:"blob" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `roblox_assets_${Date.now()}.zip`;
  document.body.appendChild(a);
  a.click();
  a.remove();

  status.textContent += "\nZIP downloaded.";
};
</script>
